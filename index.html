<!doctype html>
<html lang="nl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kwadraten Oefenen</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    html {
      height: 100%;
    }
    
    #app {
      min-height: 100%;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="app"></div>
  <script>
    const defaultConfig = {
      title: "Kwadraten oefenen",
      check_button: "Controleer",
      next_button: "Volgende",
      reset_button: "Reset Voortgang",
      background_color: "#f0f4f8",
      card_color: "#ffffff",
      text_color: "#1a202c",
      primary_button_color: "#3b82f6",
      secondary_button_color: "#64748b",
      font_family: "Segoe UI",
      font_size: 16
    };

    let currentCard = null;
    let cardStats = new Map();
    let isAnswerShown = false;
    let consecutiveCorrect = 0;

    const NUMBERS = [5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 25];

    // Load data from localStorage
    function loadData() {
      const saved = localStorage.getItem('kwadraten-stats');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          cardStats.clear();
          Object.entries(data).forEach(([num, stats]) => {
            cardStats.set(parseInt(num), {
              correct: stats.correct || 0,
              incorrect: stats.incorrect || 0,
              lastShown: stats.lastShown ? new Date(stats.lastShown) : new Date()
            });
          });
        } catch (e) {
          console.error('Error loading saved data:', e);
        }
      }
      
      if (!currentCard) {
        selectNextCard();
      }
      updateStatsDisplay();
    }

    // Save data to localStorage
    function saveData() {
      const data = {};
      cardStats.forEach((stats, num) => {
        data[num] = {
          correct: stats.correct,
          incorrect: stats.incorrect,
          lastShown: stats.lastShown.toISOString()
        };
      });
      localStorage.setItem('kwadraten-stats', JSON.stringify(data));
    }

    function selectNextCard() {
      // Sluit de huidige kaart uit van de volgende keuze
      const availableNumbers = NUMBERS.filter(num => num !== currentCard);
      
      const weights = availableNumbers.map(num => {
        const stats = cardStats.get(num);
        if (!stats) return 5; // Nieuwe kaarten krijgen normale kans
        
        const total = stats.correct + stats.incorrect;
        if (total === 0) return 5;
        
        const errorRate = stats.incorrect / total;
        const successRate = stats.correct / total;
        
        // Kaarten met meer fouten krijgen veel hogere kans
        // Kaarten die je vaak goed hebt krijgen lagere kans
        let weight = 1;
        
        if (errorRate > 0.7) {
          weight = 20; // Heel vaak fout â†’ zeer hoge kans
        } else if (errorRate > 0.5) {
          weight = 15; // Vaak fout â†’ hoge kans
        } else if (errorRate > 0.3) {
          weight = 10; // Soms fout â†’ verhoogde kans
        } else if (successRate > 0.8 && total >= 3) {
          weight = 0.5; // Bijna altijd goed â†’ lage kans
        } else {
          weight = 5; // Normale kans
        }
        
        console.log(`Kaart ${num}: ${stats.correct} goed, ${stats.incorrect} fout, errorRate: ${errorRate.toFixed(2)}, weight: ${weight}`);
        return weight;
      });

      const totalWeight = weights.reduce((sum, w) => sum + w, 0);
      let random = Math.random() * totalWeight;
      
      for (let i = 0; i < availableNumbers.length; i++) {
        random -= weights[i];
        if (random <= 0) {
          currentCard = availableNumbers[i];
          console.log(`Gekozen kaart: ${currentCard}`);
          break;
        }
      }

      isAnswerShown = false;
      
      // Eerst kaart naar voorkant draaien
      const cardInner = document.getElementById('card-inner');
      const flashcard = document.getElementById('flashcard');
      
      if (cardInner) cardInner.style.transform = 'rotateY(0deg)';
      if (flashcard) flashcard.style.cursor = 'pointer';
      
      // Wacht tot de flip-animatie klaar is voordat we de content updaten
      setTimeout(() => {
        const questionElement = document.getElementById('question');
        const answerElement = document.getElementById('answer');
        const feedbackElement = document.getElementById('feedback');
        
        if (questionElement) questionElement.textContent = `${currentCard}Â²`;
        if (answerElement) answerElement.textContent = `${currentCard * currentCard}`;
        if (feedbackElement) {
          feedbackElement.textContent = '';
          feedbackElement.className = 'feedback';
        }
      }, 300); // Wacht 300ms (helft van de 600ms flip animatie)
    }

    function renderCard() {
      const config = window.elementSdk?.config || defaultConfig;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'Tahoma, Geneva, Verdana, sans-serif';

      const cardElement = document.getElementById('flashcard');
      const cardInner = document.getElementById('card-inner');
      const questionElement = document.getElementById('question');
      const answerElement = document.getElementById('answer');
      const feedbackElement = document.getElementById('feedback');

      questionElement.textContent = `${currentCard}Â²`;
      answerElement.textContent = `${currentCard * currentCard}`;
      feedbackElement.textContent = '';
      feedbackElement.className = 'feedback';

      if (isAnswerShown) {
        cardInner.style.transform = 'rotateY(180deg)';
        cardElement.style.cursor = 'default';
      } else {
        cardInner.style.transform = 'rotateY(0deg)';
        cardElement.style.cursor = 'pointer';
      }
    }

    function showAnswer() {
      console.log('showAnswer called, isAnswerShown:', isAnswerShown);
      if (!isAnswerShown) {
        isAnswerShown = true;
        const cardInner = document.getElementById('card-inner');
        if (cardInner) {
          cardInner.style.transform = 'rotateY(180deg)';
          console.log('Card flipped to back');
        }
        const flashcard = document.getElementById('flashcard');
        if (flashcard) {
          flashcard.style.cursor = 'default';
        }
      }
    }

    function showConfetti() {
      console.log('showConfetti called, window.confetti available:', !!window.confetti);
      if (window.confetti) {
        // Meerdere confetti bursts voor extra effect
        window.confetti({
          particleCount: 100,
          spread: 70,
          origin: { y: 0.6 }
        });
        
        // Extra burst na korte vertraging
        setTimeout(() => {
          window.confetti({
            particleCount: 50,
            angle: 60,
            spread: 55,
            origin: { x: 0 }
          });
        }, 250);
        
        setTimeout(() => {
          window.confetti({
            particleCount: 50,
            angle: 120,
            spread: 55,
            origin: { x: 1 }
          });
        }, 400);
        
        console.log('Canvas confetti fired!');
      } else {
        console.error('Canvas-confetti library not loaded');
        // Fallback message met emoji's
        const feedbackElement = document.getElementById('feedback');
        if (feedbackElement) {
          feedbackElement.innerHTML = 'ðŸŽ‰ Fantastisch! Confetti! ðŸŽŠâœ¨ðŸŽˆ';
        }
      }
    }

    async function recordAnswer(isCorrect) {
      const feedbackElement = document.getElementById('feedback');
      const correctButton = document.getElementById('correct-button');
      const incorrectButton = document.getElementById('incorrect-button');

      if (isCorrect) {
        consecutiveCorrect++;
        if (consecutiveCorrect % 5 === 0) {
          feedbackElement.textContent = `ðŸŽ‰ Fantastisch! ${consecutiveCorrect} op een rij!`;
          feedbackElement.className = 'feedback correct';
          feedbackElement.style.color = '#10b981';
          showConfetti();
        } else {
          feedbackElement.textContent = 'âœ“ Goed gedaan!';
          feedbackElement.className = 'feedback correct';
          feedbackElement.style.color = '#10b981';
        }
      } else {
        consecutiveCorrect = 0;
        feedbackElement.textContent = 'âœ— Volgende keer beter!';
        feedbackElement.className = 'feedback incorrect';
        feedbackElement.style.color = '#ef4444';
      }

      correctButton.disabled = true;
      incorrectButton.disabled = true;

      const stats = cardStats.get(currentCard);

      if (stats) {
        // Update existing stats
        stats.correct += isCorrect ? 1 : 0;
        stats.incorrect += isCorrect ? 0 : 1;
        stats.lastShown = new Date();
      } else {
        // Create new stats
        cardStats.set(currentCard, {
          correct: isCorrect ? 1 : 0,
          incorrect: isCorrect ? 0 : 1,
          lastShown: new Date()
        });
      }

      // Save to localStorage
      saveData();
      updateStatsDisplay();

      correctButton.disabled = false;
      incorrectButton.disabled = false;

      // Automatisch naar volgende kaart na 1.5 seconden
      setTimeout(() => {
        selectNextCard();
      }, 1500);
    }

    function nextCard() {
      selectNextCard();
    }

    async function resetProgress() {
      const confirmElement = document.getElementById('reset-confirm');
      confirmElement.style.display = 'flex';
    }

    function confirmReset() {
      const confirmElement = document.getElementById('reset-confirm');
      const yesButton = document.getElementById('confirm-yes');
      const noButton = document.getElementById('confirm-no');
      
      yesButton.disabled = true;
      noButton.disabled = true;

      // Clear all data
      cardStats.clear();
      localStorage.removeItem('kwadraten-stats');
      consecutiveCorrect = 0; // Reset streak
      
      // Update display
      updateStatsDisplay();
      selectNextCard();

      yesButton.disabled = false;
      noButton.disabled = false;
      confirmElement.style.display = 'none';
    }

    function cancelReset() {
      const confirmElement = document.getElementById('reset-confirm');
      confirmElement.style.display = 'none';
    }

    function updateStatsDisplay() {
      const statsElement = document.getElementById('stats');
      
      if (!statsElement) return;
      
      let totalCorrect = 0;
      let totalIncorrect = 0;

      cardStats.forEach(stats => {
        totalCorrect += stats.correct;
        totalIncorrect += stats.incorrect;
      });

      const total = totalCorrect + totalIncorrect;
      const percentage = total > 0 ? Math.round((totalCorrect / total) * 100) : 0;

      const streakText = consecutiveCorrect > 1 ? ` | Streak: ${consecutiveCorrect}` : '';

      statsElement.innerHTML = `
        <div style="font-size: 14px; color: #1a202c;">
          <strong>Score:</strong> ${totalCorrect} goed / ${totalIncorrect} fout (${percentage}%)${streakText}
        </div>
      `;
    }



    async function initApp() {
      // Maak eerst de HTML
      document.getElementById('app').innerHTML = `
        <div id="container" style="min-height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 32px; background-color: #f0f4f8; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
          <div style="max-width: 600px; width: 100%; text-align: center;">
            <h1 id="title" style="margin: 0 0 32px 0; font-size: 32px; color: #1a202c;">Kwadraten oefenen</h1>
            
            <div id="flashcard" style="background-color: transparent; border-radius: 16px; margin: 0 auto 24px auto; cursor: pointer; perspective: 1000px; width: 100%; max-width: 400px; height: 300px;">
              <div id="card-inner" style="position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d;">
                <div id="card-front" style="position: absolute; width: 100%; height: 100%; backface-visibility: hidden; background-color: #ffffff; border-radius: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 32px; box-sizing: border-box;">
                  <div id="question" style="font-size: 48px; font-weight: bold; margin-bottom: 16px; color: #1a202c;">7Â²</div>
                  <div id="instruction" style="font-size: 14px; color: #64748b;">Klik op de kaart voor het antwoord</div>
                </div>
                
                <div id="card-back" style="position: absolute; width: 100%; height: 100%; backface-visibility: hidden; background-color: #ffffff; border-radius: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transform: rotateY(180deg); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 32px; box-sizing: border-box;">
                  <div id="answer" style="font-size: 48px; font-weight: bold; color: #1a202c; margin-bottom: 16px;">49</div>
                  <div id="instruction-back" style="font-size: 14px; color: #64748b; margin-bottom: 24px;">Had je het goed?</div>
                  <div id="feedback" class="feedback" style="min-height: 24px; margin-bottom: 16px; font-size: 16px; font-weight: 600;"></div>
                  <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                    <button id="correct-button" style="background-color: #10b981; color: white; border: none; padding: 12px 24px; font-size: 16px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: opacity 0.2s;">âœ“ Goed</button>
                    <button id="incorrect-button" style="background-color: #ef4444; color: white; border: none; padding: 12px 24px; font-size: 16px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: opacity 0.2s;">âœ— Fout</button>
                  </div>
                </div>
              </div>
            </div>
            
            <div id="stats" style="margin-bottom: 16px;">
              <div style="font-size: 14px; color: #1a202c;">
                <strong>Score:</strong> 0 goed / 0 fout (0%)
              </div>
            </div>
            
            <button id="reset-button" style="background-color: #64748b; color: white; border: none; padding: 8px 24px; font-size: 14px; border-radius: 8px; cursor: pointer; transition: opacity 0.2s;">Reset Voortgang</button>
            
            <div id="reset-confirm" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); align-items: center; justify-content: center; z-index: 1000;">
              <div style="background-color: #ffffff; padding: 32px; border-radius: 16px; max-width: 400px; text-align: center; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);">
                <p style="margin: 0 0 24px 0; font-size: 18px; color: #1a202c;">Weet je zeker dat je alle voortgang wilt resetten?</p>
                <div style="display: flex; gap: 12px; justify-content: center;">
                  <button id="confirm-yes" style="background-color: #ef4444; color: white; border: none; padding: 10px 24px; font-size: 16px; border-radius: 8px; cursor: pointer;">Ja, reset</button>
                  <button id="confirm-no" style="background-color: #64748b; color: white; border: none; padding: 10px 24px; font-size: 16px; border-radius: 8px; cursor: pointer;">Annuleren</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;

      // Voeg event listeners toe
      document.getElementById('flashcard').addEventListener('click', showAnswer);
      document.getElementById('correct-button').addEventListener('click', (e) => {
        e.stopPropagation();
        recordAnswer(true);
      });
      document.getElementById('incorrect-button').addEventListener('click', (e) => {
        e.stopPropagation();
        recordAnswer(false);
      });
      document.getElementById('reset-button').addEventListener('click', resetProgress);
      document.getElementById('confirm-yes').addEventListener('click', confirmReset);
      document.getElementById('confirm-no').addEventListener('click', cancelReset);

      // Hover effecten voor kaart
      const flashcard = document.getElementById('flashcard');
      const cardFront = document.getElementById('card-front');
      const cardBack = document.getElementById('card-back');
      
      flashcard.addEventListener('mouseenter', () => {
        if (!isAnswerShown) {
          cardFront.style.boxShadow = '0 8px 15px rgba(0, 0, 0, 0.15)';
          cardFront.style.transform = 'translateY(-2px)';
        } else {
          cardBack.style.boxShadow = '0 8px 15px rgba(0, 0, 0, 0.15)';
          cardBack.style.transform = 'rotateY(180deg) translateY(-2px)';
        }
      });
      flashcard.addEventListener('mouseleave', () => {
        cardFront.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
        cardFront.style.transform = 'translateY(0)';
        cardBack.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
        cardBack.style.transform = 'rotateY(180deg) translateY(0)';
      });

      // Hover effecten voor knoppen
      const buttons = ['correct-button', 'incorrect-button', 'reset-button'];
      buttons.forEach(buttonId => {
        const button = document.getElementById(buttonId);
        button.addEventListener('mouseenter', () => button.style.opacity = '0.9');
        button.addEventListener('mouseleave', () => button.style.opacity = '1');
      });

      // Load saved data and start
      loadData();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'996b15d0020290b8',t:'MTc2MTgyOTExNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
